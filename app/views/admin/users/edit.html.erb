<div class="container-fluid">
  <div class="row">
    <!-- Sidebar -->
    <nav class="col-md-3 col-lg-2 d-md-block bg-light sidebar">
      <div class="position-sticky pt-3">
        <ul class="nav flex-column">
          <li class="nav-item">
            <%= link_to admin_dashboard_path, class: "nav-link" do %>
              <i class="bi bi-speedometer2"></i> Dashboard
            <% end %>
          </li>
          <li class="nav-item">
            <%= link_to admin_users_path, class: "nav-link active" do %>
              <i class="bi bi-people"></i> Users
            <% end %>
          </li>
        </ul>
      </div>
    </nav>

    <!-- Main content -->
    <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
      <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
        <h1 class="h2">Edit User</h1>
        <div class="btn-toolbar mb-2 mb-md-0">
          <%= link_to admin_users_path, class: "btn btn-sm btn-outline-secondary" do %>
            <i class="bi bi-arrow-left"></i> Back to Users
          <% end %>
        </div>
      </div>

      <div class="row">
        <div class="col-lg-8">
          <div class="card shadow mb-4">
            <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
              <h6 class="m-0 font-weight-bold text-primary">User Details</h6>
            </div>
            <div class="card-body">
              <%= form_with(model: [:admin, @user], local: true) do |f| %>
                <% if @user.errors.any? %>
                  <div class="alert alert-danger">
                    <h2><%= pluralize(@user.errors.count, "error") %> prohibited this user from being saved:</h2>
                    <ul>
                      <% @user.errors.full_messages.each do |message| %>
                        <li><%= message %></li>
                      <% end %>
                    </ul>
                  </div>
                <% end %>

                <div class="row">
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Username</label>
                    <input type="text" class="form-control" value="<%= @user.username %>" readonly>
                  </div>

                  <div class="col-md-6 mb-3">
                    <label class="form-label">Name</label>
                    <input type="text" class="form-control" value="<%= @user.name %>" readonly>
                  </div>
                </div>

                <div class="row">
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-control" value="<%= @user.email %>" readonly>
                  </div>

                  <div class="col-md-6 mb-3">
                    <%= f.label :role_id, "Role", class: "form-label" %>
                    <%= f.select :role_id, User.role_ids.map { |k, v| [k.titleize, k] },
                                {}, 
                                class: "form-select",
                                data: { 
                                  confirm: "Are you sure you want to change this user's role?",
                                  bs_toggle: "tooltip",
                                  bs_placement: "top",
                                  bs_title: "Changing a user's role will affect their permissions"
                                } %>
                  </div>
                </div>

                <div class="alert alert-info">
                  <i class="bi bi-info-circle"></i>
                  <strong>Note:</strong> Only the user's role can be modified from this interface.
                  Users must update their own profile information.
                </div>

                <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                  <%= f.submit "Update User", class: "btn btn-primary me-md-2" %>
                  <%= link_to "Cancel", admin_users_path, class: "btn btn-secondary" %>
                </div>
              <% end %>
            </div>
          </div>
        </div>

        <div class="col-lg-4">
          <div class="card shadow mb-4">
            <div class="card-header py-3">
              <h6 class="m-0 font-weight-bold text-primary">User Information</h6>
            </div>
            <div class="card-body">
              <div class="text-center mb-4">
                <div class="avatar bg-light rounded-circle p-3 mx-auto" style="width: 80px; height: 80px;">
                  <i class="bi bi-person fs-1"></i>
                </div>
                <h5 class="mt-3 mb-0"><%= @user.name %></h5>
                <p class="text-muted"><%= @user.username %></p>
              </div>

              <div class="mb-3">
                <strong>Member Since:</strong><br>
                <%= @user.created_at.strftime('%B %d, %Y') %>
              </div>

              <div class="mb-3">
                <strong>Current Role:</strong><br>
                <span class="badge bg-<%= @user.administrator? ? 'danger' : (@user.moderator? ? 'warning' : 'primary') %>">
                  <%= @user.role_id.titleize %>
                </span>
              </div>

              <div class="mb-3">
                <strong>Location:</strong><br>
                <%= @user.city %>, <%= @user.state %><br>
                <%= @user.country %>
              </div>

              <div class="mb-3">
                <strong>Last Sign In:</strong><br>
                <%= @user.last_sign_in_at&.strftime('%B %d, %Y %H:%M') || 'Never' %>
              </div>
            </div>
          </div>
        </div>
      </div>

      <% content_for :page_scripts do %>
        <script>
          document.addEventListener('DOMContentLoaded', function() {
            var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
            var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
              return new bootstrap.Tooltip(tooltipTriggerEl)
            })
          });
        </script>
      <% end %>
    </main>
  </div>
</div>
