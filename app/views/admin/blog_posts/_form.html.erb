<%= form_with(model: [:admin, blog_post], local: true, class: "needs-validation") do |f| %>
  <% if blog_post.errors.any? %>
    <div class="alert alert-danger">
      <h4><%= pluralize(blog_post.errors.count, "error") %> prohibited this post from being saved:</h4>
      <ul>
        <% blog_post.errors.full_messages.each do |msg| %>
          <li><%= msg %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="mb-3">
    <%= f.label :title, class: "form-label" %>
    <%= f.text_field :title, class: "form-control", required: true %>
  </div>

  <div class="mb-3">
    <%= f.label :blog_category_id, "Category", class: "form-label" %>
    <%= f.collection_select :blog_category_id, BlogCategory.all, :id, :name, 
        { prompt: "Select a category" }, 
        { class: "form-select", required: true } %>
  </div>

  <div class="mb-3">
    <%= f.label :content, class: "form-label" %>
    <%= f.rich_text_area :content, 
        class: "trix-content",
        data: { 
          controller: "trix-uploads",
          direct_upload_url: admin_direct_uploads_path,
          blob_url_template: rails_service_blob_path(":signed_id", ":filename")
        } %>
    <small class="form-text text-muted">
      You can upload images by dragging and dropping them into the editor or using the image button.
    </small>
  </div>

  <div class="mb-3">
    <%= f.label :tag_names, "Tags", class: "form-label" %>
    <%= f.text_field :tag_names, 
        value: blog_post.tags.pluck(:name).join(", "),
        class: "form-control",
        data: {
          controller: "tags",
          tags_url_value: admin_tags_search_path
        } %>
    <small class="form-text text-muted">Enter tags separated by commas</small>
  </div>

  <div class="mb-3">
    <div class="form-check form-switch">
      <%= f.check_box :published, class: "form-check-input", role: "switch" %>
      <%= f.label :published, class: "form-check-label" %>
    </div>
  </div>

  <div class="mt-4">
    <%= f.submit class: "btn btn-primary" %>
    <%= link_to "Cancel", admin_blog_posts_path, class: "btn btn-outline-secondary ms-2" %>
  </div>
<% end %>

<%# Add Tom Select for tag input %>
<%= javascript_include_tag "https://cdn.jsdelivr.net/npm/tom-select@2.2.2/dist/js/tom-select.complete.min.js" %>
<%= stylesheet_link_tag "https://cdn.jsdelivr.net/npm/tom-select@2.2.2/dist/css/tom-select.bootstrap5.min.css" %>

<%# Add Trix styles %>
<%= stylesheet_link_tag "trix/dist/trix" %>

<%# Add custom styles for Trix editor %>
<style>
  .trix-content {
    min-height: 400px;
    max-height: 800px;
    overflow-y: auto;
  }
  
  .trix-button-group--file-tools {
    display: none !important;
  }
  
  .attachment--preview {
    margin: 0.6em 0;
    text-align: center;
    width: 100%;
  }
  
  .attachment--preview .attachment__caption {
    color: #666;
    font-size: 0.9em;
    padding: 0.3em 0;
  }
  
  .attachment--preview img {
    max-width: 100%;
    height: auto;
  }
</style>
